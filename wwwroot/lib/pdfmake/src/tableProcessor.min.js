/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/pdfmake@0.1.68/src/tableProcessor.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var ColumnCalculator=require("./columnCalculator"),isFunction=require("./helpers").isFunction,isNumber=require("./helpers").isNumber;function TableProcessor(t){this.tableNode=t}TableProcessor.prototype.beginTable=function(t){var o,e,r,a=this;o=this.tableNode,this.offsets=o._offsets,this.layout=o._layout,e=t.context().availableWidth-this.offsets.total,ColumnCalculator.buildColumnWidths(o.table.widths,e),this.tableWidth=o._offsets.total+(r=0,o.table.widths.forEach(function(t){r+=t._calcWidth}),r),this.rowSpanData=function(){var t=[],o=0,e=0;t.push({left:0,rowSpan:0});for(var r=0,i=a.tableNode.table.body[0].length;r<i;r++){var l=a.layout.paddingLeft(r,a.tableNode)+a.layout.paddingRight(r,a.tableNode),n=a.layout.vLineWidth(r,a.tableNode);e=l+n+a.tableNode.table.widths[r]._calcWidth,t[t.length-1].width=e,o+=e,t.push({left:o,rowSpan:0,width:0})}return t}(),this.cleanUpRepeatables=!1,this.headerRows=o.table.headerRows||0,this.rowsWithoutPageBreak=this.headerRows+(o.table.keepWithHeaderRows||0),this.dontBreakRows=o.table.dontBreakRows||!1,this.rowsWithoutPageBreak&&t.beginUnbreakableBlock(),function(t){for(var o=0;o<t.length;o++)for(var e=t[o],r=0;r<e.length;r++){var a=e[r];if(a.border){for(var i=a.rowSpan||1,l=a.colSpan||1,n=0;n<i;n++)void 0!==a.border[0]&&n>0&&d(o+n,r,0,a.border[0]),void 0!==a.border[2]&&d(o+n,r+l-1,2,a.border[2]);for(var h=0;h<l;h++)void 0!==a.border[1]&&h>0&&d(o,r+h,1,a.border[1]),void 0!==a.border[3]&&d(o+i-1,r+h,3,a.border[3])}}function d(o,e,r,a){var i=t[o][e];i.border=i.border||{},i.border[r]=a}}(this.tableNode.table.body),this.drawHorizontalLine(0,t)},TableProcessor.prototype.onRowBreak=function(t,o){var e=this;return function(){var t=e.rowPaddingTop+(e.headerRows?0:e.topLineWidth);o.context().availableHeight-=e.reservedAtBottom,o.context().moveDown(t)}},TableProcessor.prototype.beginRow=function(t,o){this.topLineWidth=this.layout.hLineWidth(t,this.tableNode),this.rowPaddingTop=this.layout.paddingTop(t,this.tableNode),this.bottomLineWidth=this.layout.hLineWidth(t+1,this.tableNode),this.rowPaddingBottom=this.layout.paddingBottom(t,this.tableNode),this.rowCallback=this.onRowBreak(t,o),o.tracker.startTracking("pageChanged",this.rowCallback),this.dontBreakRows&&o.beginUnbreakableBlock(),this.rowTopY=o.context().y,this.reservedAtBottom=this.bottomLineWidth+this.rowPaddingBottom,o.context().availableHeight-=this.reservedAtBottom,o.context().moveDown(this.rowPaddingTop)},TableProcessor.prototype.drawHorizontalLine=function(t,o,e){var r=this.layout.hLineWidth(t,this.tableNode);if(r){var a,i=this.layout.hLineStyle(t,this.tableNode);i&&i.dash&&(a=i.dash);for(var l,n,h,d=r/2,s=null,b=this.tableNode.table.body,u=0,p=this.rowSpanData.length;u<p;u++){var f=this.rowSpanData[u],c=!f.rowSpan,w=null;if(c&&u<p-1){var y=!1,v=!1,g=!1;t>0&&(v=(l=b[t-1][u]).border?l.border[3]:this.layout.defaultBorder)&&l.borderColor&&(w=l.borderColor[3]),t<b.length&&(y=(n=b[t][u]).border?n.border[1]:this.layout.defaultBorder)&&null==w&&n.borderColor&&(w=n.borderColor[1]),c=y||v}if(l&&l._rowSpanCurrentOffset&&(g=(h=b[t-1-l._rowSpanCurrentOffset][u])&&h.border?h.border[3]:this.layout.defaultBorder)&&h&&h.borderColor&&(w=h.borderColor[3]),null==w&&(w=isFunction(this.layout.hLineColor)?this.layout.hLineColor(t,this.tableNode,u):this.layout.hLineColor),!s&&c&&(s={left:f.left,width:0}),c){var S=0;if(h&&h.colSpan&&g){for(;h.colSpan>S;)s.width+=this.rowSpanData[u+S++].width||0;u+=S-1}else if(l&&l.colSpan&&v){for(;l.colSpan>S;)s.width+=this.rowSpanData[u+S++].width||0;u+=S-1}else if(n&&n.colSpan&&y){for(;n.colSpan>S;)s.width+=this.rowSpanData[u+S++].width||0;u+=S-1}else s.width+=this.rowSpanData[u].width||0}var C=(e||0)+d;c&&s&&s.width&&(o.addVector({type:"line",x1:s.left,x2:s.left+s.width,y1:C,y2:C,lineWidth:r,dash:a,lineColor:w},!1,e),s=null,w=null,l=null,n=null,h=null)}o.context().moveDown(r)}},TableProcessor.prototype.drawVerticalLine=function(t,o,e,r,a,i,l){var n=this.layout.vLineWidth(r,this.tableNode);if(0!==n){var h,d=this.layout.vLineStyle(r,this.tableNode);d&&d.dash&&(h=d.dash);var s,b,u,p=this.tableNode.table.body;if(r>0&&(s=p[i][l])&&s.borderColor&&(s.border?s.border[2]:this.layout.defaultBorder)&&(u=s.borderColor[2]),null==u&&r<p.length&&(b=p[i][r])&&b.borderColor&&(b.border?b.border[0]:this.layout.defaultBorder)&&(u=b.borderColor[0]),null==u&&s&&s._rowSpanCurrentOffset){var f=p[i-s._rowSpanCurrentOffset][l];f.borderColor&&(f.border?f.border[2]:this.layout.defaultBorder)&&(u=f.borderColor[2])}if(null==u&&b&&b._rowSpanCurrentOffset){var c=p[i-b._rowSpanCurrentOffset][r];c.borderColor&&(c.border?c.border[2]:this.layout.defaultBorder)&&(u=c.borderColor[2])}null==u&&(u=isFunction(this.layout.vLineColor)?this.layout.vLineColor(r,this.tableNode,i):this.layout.vLineColor),a.addVector({type:"line",x1:t+n/2,x2:t+n/2,y1:o,y2:e,lineWidth:n,dash:h,lineColor:u},!1,!0),s=null,b=null,u=null}},TableProcessor.prototype.endTable=function(t){this.cleanUpRepeatables&&t.popFromRepeatables()},TableProcessor.prototype.endRow=function(t,o,e){var r,a,i=this;o.tracker.stopTracking("pageChanged",this.rowCallback),o.context().moveDown(this.layout.paddingBottom(t,this.tableNode)),o.context().availableHeight+=this.reservedAtBottom;var l=o.context().page,n=o.context().y,h=function(){for(var o=[],e=0,r=0,a=i.tableNode.table.body[t].length;r<a;r++){if(!e){o.push({x:i.rowSpanData[r].left,index:r});var l=i.tableNode.table.body[t][r];e=l._colSpan||l.colSpan||0}e>0&&e--}return o.push({x:i.rowSpanData[i.rowSpanData.length-1].left,index:i.rowSpanData.length-1}),o}(),d=[],s=e&&e.length>0,b=this.tableNode.table.body;if(d.push({y0:this.rowTopY,page:s?e[0].prevPage:l}),s)for(a=0,r=e.length;a<r;a++){var u=e[a];d[d.length-1].y1=u.prevY,d.push({y0:u.y,page:u.prevPage+1})}d[d.length-1].y1=n;for(var p=d[0].y1-d[0].y0===this.rowPaddingTop?1:0,f=d.length;p<f;p++){var c=p<d.length-1,w=p>0&&!this.headerRows,y=w?0:this.topLineWidth,v=d[p].y0,g=d[p].y1;for(c&&(g+=this.rowPaddingBottom),o.context().page!=d[p].page&&(o.context().page=d[p].page,this.reservedAtBottom=0),a=0,r=h.length;a<r;a++){var S,C=!1,B=!1,L=h[a].index;if(L<b[t].length)C=(S=b[t][L]).border?S.border[0]:this.layout.defaultBorder,B=S.border?S.border[2]:this.layout.defaultBorder;if(L>0&&!C)C=(S=b[t][L-1]).border?S.border[2]:this.layout.defaultBorder;if(L+1<b[t].length&&!B)B=(S=b[t][L+1]).border?S.border[0]:this.layout.defaultBorder;if(C&&this.drawVerticalLine(h[a].x,v-y,g+this.bottomLineWidth,h[a].index,o,t,h[a-1]?h[a-1].index:null),a<r-1){var N=b[t][L].fillColor,k=b[t][L].fillOpacity;if(N||(N=isFunction(this.layout.fillColor)?this.layout.fillColor(t,this.tableNode,L):this.layout.fillColor),isNumber(k)||(k=isFunction(this.layout.fillOpacity)?this.layout.fillOpacity(t,this.tableNode,L):this.layout.fillOpacity),N){var x,m=C?this.layout.vLineWidth(L,this.tableNode):0;x=0!==L&&L+1!=b[t].length||B?B?this.layout.vLineWidth(L+1,this.tableNode)/2:0:this.layout.vLineWidth(L+1,this.tableNode);var R=this.dontBreakRows?h[a].x+m:h[a].x+m/2,W=this.dontBreakRows?v:v-y/2,T=h[a+1].x+x,P=this.dontBreakRows?g+this.bottomLineWidth:g+this.bottomLineWidth/2;o.addVector({type:"rect",x:R,y:W,w:T-R,h:P-W,lineWidth:0,color:N,fillOpacity:k},!1,!0,o.context().backgroundLength[o.context().page])}}}c&&!1!==this.layout.hLineWhenBroken&&this.drawHorizontalLine(t+1,o,g),w&&!1!==this.layout.hLineWhenBroken&&this.drawHorizontalLine(t,o,v)}o.context().page=l,o.context().y=n;var D=this.tableNode.table.body[t];for(a=0,r=D.length;a<r;a++){if(D[a].rowSpan){if(this.rowSpanData[a].rowSpan=D[a].rowSpan,D[a].colSpan&&D[a].colSpan>1)for(var _=1;_<D[a].rowSpan;_++)this.tableNode.table.body[t+_][a]._colSpan=D[a].colSpan;if(D[a].rowSpan&&D[a].rowSpan>1)for(_=1;_<D[a].rowSpan;_++)this.tableNode.table.body[t+_][a]._rowSpanCurrentOffset=_}this.rowSpanData[a].rowSpan>0&&this.rowSpanData[a].rowSpan--}this.drawHorizontalLine(t+1,o),this.headerRows&&t===this.headerRows-1&&(this.headerRepeatable=o.currentBlockToRepeatable()),this.dontBreakRows&&o.tracker.auto("pageChanged",function(){i.headerRows||!1===i.layout.hLineWhenBroken||i.drawHorizontalLine(t,o)},function(){o.commitUnbreakableBlock()}),!this.headerRepeatable||t!==this.rowsWithoutPageBreak-1&&t!==this.tableNode.table.body.length-1||(o.commitUnbreakableBlock(),o.pushToRepeatables(this.headerRepeatable),this.cleanUpRepeatables=!0,this.headerRepeatable=null)},module.exports=TableProcessor;
//# sourceMappingURL=/sm/8e030109d4f10a78c575e95ad370fe6168f4d4f0bf1a7d577fceedf9852893c1.map