/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/pdfmake@0.1.68/src/docMeasure.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var TextTools=require("./textTools"),StyleContextStack=require("./styleContextStack"),ColumnCalculator=require("./columnCalculator"),isString=require("./helpers").isString,isNumber=require("./helpers").isNumber,isObject=require("./helpers").isObject,isArray=require("./helpers").isArray,fontStringify=require("./helpers").fontStringify,getNodeId=require("./helpers").getNodeId,pack=require("./helpers").pack,qrEncoder=require("./qrEnc.js");function DocMeasure(t,e,i,r,a,n,o){this.textTools=new TextTools(t),this.styleStack=new StyleContextStack(e,i),this.imageMeasure=r,this.svgMeasure=a,this.tableLayouts=n,this.images=o,this.autoImageIndex=1}DocMeasure.prototype.measureDocument=function(t){return this.measureNode(t)},DocMeasure.prototype.measureNode=function(t){var e=this;return this.styleStack.auto(t,function(){if(t._margin=function(){function i(t,e){return t.marginLeft||t.marginTop||t.marginRight||t.marginBottom?[t.marginLeft||e[0]||0,t.marginTop||e[1]||0,t.marginRight||e[2]||0,t.marginBottom||e[3]||0]:e}function r(t){return isNumber(t)?t=[t,t,t,t]:isArray(t)&&2===t.length&&(t=[t[0],t[1],t[0],t[1]]),t}var a=[void 0,void 0,void 0,void 0];if(t.style){var n=isArray(t.style)?t.style:[t.style],o=function(t){for(var i={},r=t.length-1;r>=0;r--){var a=t[r],n=e.styleStack.styleDictionary[a];for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o])}return i}(n);o&&(a=i(o,a)),o.margin&&(a=r(o.margin))}a=i(t,a),t.margin&&(a=r(t.margin));return void 0===a[0]&&void 0===a[1]&&void 0===a[2]&&void 0===a[3]?null:a}(),t.columns)return i(e.measureColumns(t));if(t.stack)return i(e.measureVerticalContainer(t));if(t.ul)return i(e.measureUnorderedList(t));if(t.ol)return i(e.measureOrderedList(t));if(t.table)return i(e.measureTable(t));if(void 0!==t.text)return i(e.measureLeaf(t));if(t.toc)return i(e.measureToc(t));if(t.image)return i(e.measureImage(t));if(t.svg)return i(e.measureSVG(t));if(t.canvas)return i(e.measureCanvas(t));if(t.qr)return i(e.measureQr(t));throw"Unrecognized document structure: "+JSON.stringify(t,fontStringify)});function i(t){var e=t._margin;return e&&(t._minWidth+=e[0]+e[2],t._maxWidth+=e[0]+e[2]),t}},DocMeasure.prototype.convertIfBase64Image=function(t){if(/^data:image\/(jpeg|jpg|png);base64,/.test(t.image)){var e="$$pdfmake$$"+this.autoImageIndex++;this.images[e]=t.image,t.image=e}},DocMeasure.prototype.measureImageWithDimensions=function(t,e){if(t.fit){var i=e.width/e.height>t.fit[0]/t.fit[1]?t.fit[0]/e.width:t.fit[1]/e.height;t._width=t._minWidth=t._maxWidth=e.width*i,t._height=e.height*i}else t._width=t._minWidth=t._maxWidth=t.width||e.width,t._height=t.height||e.height*t._width/e.width,isNumber(t.maxWidth)&&t.maxWidth<t._width&&(t._width=t._minWidth=t._maxWidth=t.maxWidth,t._height=t._width*e.height/e.width),isNumber(t.maxHeight)&&t.maxHeight<t._height&&(t._height=t.maxHeight,t._width=t._minWidth=t._maxWidth=t._height*e.width/e.height),isNumber(t.minWidth)&&t.minWidth>t._width&&(t._width=t._minWidth=t._maxWidth=t.minWidth,t._height=t._width*e.height/e.width),isNumber(t.minHeight)&&t.minHeight>t._height&&(t._height=t.minHeight,t._width=t._minWidth=t._maxWidth=t._height*e.width/e.height);t._alignment=this.styleStack.getProperty("alignment")},DocMeasure.prototype.measureImage=function(t){this.images&&this.convertIfBase64Image(t);var e=this.imageMeasure.measureImage(t.image);return this.measureImageWithDimensions(t,e),t},DocMeasure.prototype.measureSVG=function(t){var e=this.svgMeasure.measureSVG(t.svg);return this.measureImageWithDimensions(t,e),t.font=this.styleStack.getProperty("font"),t.svg=this.svgMeasure.writeDimensions(t.svg,{width:t._width,height:t._height}),t},DocMeasure.prototype.measureLeaf=function(t){t._textRef&&t._textRef._textNodeRef.text&&(t.text=t._textRef._textNodeRef.text);var e=this.styleStack.clone();e.push(t);var i=this.textTools.buildInlines(t.text,e);return t._inlines=i.items,t._minWidth=i.minWidth,t._maxWidth=i.maxWidth,t},DocMeasure.prototype.measureToc=function(t){if(t.toc.title&&(t.toc.title=this.measureNode(t.toc.title)),t.toc._items.length>0){for(var e=[],i=t.toc.textStyle||{},r=t.toc.numberStyle||i,a=t.toc.textMargin||[0,0,0,0],n=0,o=t.toc._items.length;n<o;n++){var s=t.toc._items[n],h=s._textNodeRef.tocStyle||i,l=s._textNodeRef.tocMargin||a,u=s._textNodeRef.tocNumberStyle||r,d=getNodeId(s._nodeRef);e.push([{text:s._textNodeRef.text,linkToDestination:d,alignment:"left",style:h,margin:l},{text:"00000",linkToDestination:d,alignment:"right",_tocItemRef:s._nodeRef,style:u,margin:[0,l[1],0,l[3]]}])}t.toc._table={table:{dontBreakRows:!0,widths:["*","auto"],body:e},layout:"noBorders"},t.toc._table=this.measureNode(t.toc._table)}return t},DocMeasure.prototype.measureVerticalContainer=function(t){var e=t.stack;t._minWidth=0,t._maxWidth=0;for(var i=0,r=e.length;i<r;i++)e[i]=this.measureNode(e[i]),t._minWidth=Math.max(t._minWidth,e[i]._minWidth),t._maxWidth=Math.max(t._maxWidth,e[i]._maxWidth);return t},DocMeasure.prototype.gapSizeForList=function(){return this.textTools.sizeOfString("9. ",this.styleStack)},DocMeasure.prototype.buildUnorderedMarker=function(t,e,i){var r,a=t.getProperty("markerColor")||t.getProperty("color")||"black";switch(i){case"circle":r=function(t,e){var i=t.fontSize/6;return{canvas:[{x:i,y:t.height/t.lineHeight+t.descender-t.fontSize/3,r1:i,r2:i,type:"ellipse",lineColor:e}]}}(e,a);break;case"square":r=function(t,e){var i=t.fontSize/3;return{canvas:[{x:0,y:t.height/t.lineHeight+t.descender-t.fontSize/3-i/2,h:i,w:i,type:"rect",color:e}]}}(e,a);break;case"none":r={};break;case"disc":default:r=function(t,e){var i=t.fontSize/6;return{canvas:[{x:i,y:t.height/t.lineHeight+t.descender-t.fontSize/3,r1:i,r2:i,type:"ellipse",color:e}]}}(e,a)}return r._minWidth=r._maxWidth=e.width,r._minHeight=r._maxHeight=e.height,r},DocMeasure.prototype.buildOrderedMarker=function(t,e,i,r){function a(t){return t<1?t.toString():function t(e){return(e>=26?t((e/26>>0)-1):"")+"abcdefghijklmnopqrstuvwxyz"[e%26>>0]}(t-1)}function n(t){if(t<1||t>4999)return t.toString();var e,i=t,r={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},a="";for(e in r)for(;i>=r[e];)a+=e,i-=r[e];return a}var o;switch(i){case"none":o=null;break;case"upper-alpha":o=a(t).toUpperCase();break;case"lower-alpha":o=a(t);break;case"upper-roman":o=n(t);break;case"lower-roman":o=n(t).toLowerCase();break;case"decimal":default:o=function(t){return t.toString()}(t)}if(null===o)return{};r&&(isArray(r)?(r[0]&&(o=r[0]+o),r[1]&&(o+=r[1]),o+=" "):o+=r+" ");var s={text:o},h=e.getProperty("markerColor");return h&&(s.color=h),{_inlines:this.textTools.buildInlines(s,e).items}},DocMeasure.prototype.measureUnorderedList=function(t){var e=this.styleStack.clone(),i=t.ul;t.type=t.type||"disc",t._gapSize=this.gapSizeForList(),t._minWidth=0,t._maxWidth=0;for(var r=0,a=i.length;r<a;r++){var n=i[r]=this.measureNode(i[r]);n.ol||n.ul||(n.listMarker=this.buildUnorderedMarker(e,t._gapSize,n.listType||t.type)),t._minWidth=Math.max(t._minWidth,i[r]._minWidth+t._gapSize.width),t._maxWidth=Math.max(t._maxWidth,i[r]._maxWidth+t._gapSize.width)}return t},DocMeasure.prototype.measureOrderedList=function(t){var e=this.styleStack.clone(),i=t.ol;t.type=t.type||"decimal",t.separator=t.separator||".",t.reversed=t.reversed||!1,isNumber(t.start)||(t.start=t.reversed?i.length:1),t._gapSize=this.gapSizeForList(),t._minWidth=0,t._maxWidth=0;for(var r=t.start,a=0,n=i.length;a<n;a++){if(!(s=i[a]=this.measureNode(i[a])).ol&&!s.ul){var o=isNumber(s.counter)?s.counter:r;s.listMarker=this.buildOrderedMarker(o,e,s.listType||t.type,t.separator),s.listMarker._inlines&&(t._gapSize.width=Math.max(t._gapSize.width,s.listMarker._inlines[0].width))}t._minWidth=Math.max(t._minWidth,i[a]._minWidth),t._maxWidth=Math.max(t._maxWidth,i[a]._maxWidth),t.reversed?r--:r++}t._minWidth+=t._gapSize.width,t._maxWidth+=t._gapSize.width;for(a=0,n=i.length;a<n;a++){var s;(s=i[a]).ol||s.ul||(s.listMarker._minWidth=s.listMarker._maxWidth=t._gapSize.width)}return t},DocMeasure.prototype.measureColumns=function(t){var e=t.columns;t._gap=this.styleStack.getProperty("columnGap")||0;for(var i=0,r=e.length;i<r;i++)e[i]=this.measureNode(e[i]);var a=ColumnCalculator.measureMinMax(e),n=e.length>0?e.length-1:0;return t._minWidth=a.min+t._gap*n,t._maxWidth=a.max+t._gap*n,t},DocMeasure.prototype.measureTable=function(t){!function(t){t.table.widths||(t.table.widths="auto");if(isString(t.table.widths))for(t.table.widths=[t.table.widths];t.table.widths.length<t.table.body[0].length;)t.table.widths.push(t.table.widths[t.table.widths.length-1]);for(var e=0,i=t.table.widths.length;e<i;e++){var r=t.table.widths[e];(isNumber(r)||isString(r))&&(t.table.widths[e]={width:r})}}(t),t._layout=function(e){var i=t.layout;isString(i)&&(i=e[i]);return pack({hLineWidth:function(t,e){return 1},vLineWidth:function(t,e){return 1},hLineColor:function(t,e){return"black"},vLineColor:function(t,e){return"black"},hLineStyle:function(t,e){return null},vLineStyle:function(t,e){return null},paddingLeft:function(t,e){return 4},paddingRight:function(t,e){return 4},paddingTop:function(t,e){return 2},paddingBottom:function(t,e){return 2},fillColor:function(t,e){return null},fillOpacity:function(t,e){return 1},defaultBorder:!0},i)}(this.tableLayouts),t._offsets=function(e){for(var i=[],r=0,a=0,n=0,o=t.table.widths.length;n<o;n++){var s=a+e.vLineWidth(n,t)+e.paddingLeft(n,t);i.push(s),r+=s,a=e.paddingRight(n,t)}return{total:r+=a+e.vLineWidth(t.table.widths.length,t),offsets:i}}(t._layout);var e,i,r,a,n=[];for(e=0,r=t.table.body[0].length;e<r;e++){var o=t.table.widths[e];for(o._minWidth=0,o._maxWidth=0,i=0,a=t.table.body.length;i<a;i++){var s=t.table.body[i],h=s[e];if(void 0===h)throw console.error("Malformed table row ",s,"in node ",t),"Malformed table row, a cell is undefined.";null===h&&(h=""),h._span||((h=s[e]=this.styleStack.auto(h,u(this,h))).colSpan&&h.colSpan>1?(m(s,e,h.colSpan),n.push({col:e,span:h.colSpan,minWidth:h._minWidth,maxWidth:h._maxWidth})):(o._minWidth=Math.max(o._minWidth,h._minWidth),o._maxWidth=Math.max(o._maxWidth,h._maxWidth))),h.rowSpan&&h.rowSpan>1&&c(t.table,i,e,h.rowSpan)}}!function(){for(var e,i,r=0,a=n.length;r<a;r++){var o=n[r],s=d(o.col,o.span,t._offsets),h=o.minWidth-s.minWidth,l=o.maxWidth-s.maxWidth;if(h>0)for(e=h/o.span,i=0;i<o.span;i++)t.table.widths[o.col+i]._minWidth+=e;if(l>0)for(e=l/o.span,i=0;i<o.span;i++)t.table.widths[o.col+i]._maxWidth+=e}}();var l=ColumnCalculator.measureMinMax(t.table.widths);return t._minWidth=l.min+t._offsets.total,t._maxWidth=l.max+t._offsets.total,t;function u(t,e){return function(){return isObject(e)&&(e.fillColor=t.styleStack.getProperty("fillColor"),e.fillOpacity=t.styleStack.getProperty("fillOpacity")),t.measureNode(e)}}function d(e,i,r){for(var a={minWidth:0,maxWidth:0},n=0;n<i;n++)a.minWidth+=t.table.widths[e+n]._minWidth+(n?r.offsets[e+n]:0),a.maxWidth+=t.table.widths[e+n]._maxWidth+(n?r.offsets[e+n]:0);return a}function m(t,e,i){for(var r=1;r<i;r++)t[e+r]={_span:!0,_minWidth:0,_maxWidth:0,rowSpan:t[e].rowSpan}}function c(t,e,i,r){for(var a=1;a<r;a++)t.body[e+a][i]={_span:!0,_minWidth:0,_maxWidth:0,fillColor:t.body[e][i].fillColor,fillOpacity:t.body[e][i].fillOpacity}}},DocMeasure.prototype.measureCanvas=function(t){for(var e=0,i=0,r=0,a=t.canvas.length;r<a;r++){var n=t.canvas[r];switch(n.type){case"ellipse":e=Math.max(e,n.x+n.r1),i=Math.max(i,n.y+n.r2);break;case"rect":e=Math.max(e,n.x+n.w),i=Math.max(i,n.y+n.h);break;case"line":e=Math.max(e,n.x1,n.x2),i=Math.max(i,n.y1,n.y2);break;case"polyline":for(var o=0,s=n.points.length;o<s;o++)e=Math.max(e,n.points[o].x),i=Math.max(i,n.points[o].y)}}return t._minWidth=t._maxWidth=e,t._minHeight=t._maxHeight=i,t._alignment=this.styleStack.getProperty("alignment"),t},DocMeasure.prototype.measureQr=function(t){return(t=qrEncoder.measure(t))._alignment=this.styleStack.getProperty("alignment"),t},module.exports=DocMeasure;
//# sourceMappingURL=/sm/c3290c5bb8ae6e6b6004e4eca8c1eb69b3c69da77d400ad143c94d4d600a7825.map