/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/pdfmake@0.1.68/src/printer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var PdfKitEngine=require("./pdfKitEngine"),FontProvider=require("./fontProvider"),LayoutBuilder=require("./layoutBuilder"),sizes=require("./standardPageSizes"),ImageMeasure=require("./imageMeasure"),SVGMeasure=require("./svgMeasure"),textDecorator=require("./textDecorator"),TextTools=require("./textTools"),isFunction=require("./helpers").isFunction,isString=require("./helpers").isString,isNumber=require("./helpers").isNumber,isBoolean=require("./helpers").isBoolean,isArray=require("./helpers").isArray,isUndefined=require("./helpers").isUndefined,getSvgToPDF=function(){try{return require("svg-to-pdfkit")}catch(e){throw new Error("Please install svg-to-pdfkit to enable svg nodes")}},findFont=function(e,t,i){for(var n=0;n<t.length;n++){var r=t[n].toLowerCase();for(var o in e)if(o.toLowerCase()===r)return o}return i};function PdfPrinter(e){this.fontDescriptors=e}function setMetadata(e,t){function i(e){var t=e.charAt(0).toUpperCase()+e.slice(1);return-1!==["Title","Author","Subject","Keywords","Creator","Producer","CreationDate","ModDate","Trapped"].indexOf(t)?t:e.replace(/\s+/g,"")}if(t.info.Producer="pdfmake",t.info.Creator="pdfmake",e.info)for(var n in e.info){var r=e.info[n];r&&(n=i(n),t.info[n]=r)}}function calculatePageHeight(e,t){function i(e){return e.item.y+function(e){return isFunction(e.item.getHeight)?e.item.getHeight():e.item._height?e.item._height:0}(e)}var n=fixPageMargins(t||40),r=n.top;return e.forEach(function(e){e.items.forEach(function(e){var t=i(e);t>r&&(r=t)})}),r+=n.bottom}function fixPageSize(e,t){e&&"auto"===e.height&&(e.height=1/0);var i=pageSize2widthAndHeight(e||"A4");return function(e){return!!isString(e)&&("portrait"===(e=e.toLowerCase())&&i.width>i.height||"landscape"===e&&i.width<i.height)}(t)&&(i={width:i.height,height:i.width}),i.orientation=i.width>i.height?"landscape":"portrait",i}function fixPageMargins(e){if(isNumber(e))e={left:e,right:e,top:e,bottom:e};else if(isArray(e))if(2===e.length)e={left:e[0],top:e[1],right:e[0],bottom:e[1]};else{if(4!==e.length)throw"Invalid pageMargins definition";e={left:e[0],top:e[1],right:e[2],bottom:e[3]}}return e}function registerDefaultTableLayouts(e){e.registerTableLayouts({noBorders:{hLineWidth:function(e){return 0},vLineWidth:function(e){return 0},paddingLeft:function(e){return e?4:0},paddingRight:function(e,t){return e<t.table.widths.length-1?4:0}},headerLineOnly:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?0:e===t.table.headerRows?2:0},vLineWidth:function(e){return 0},paddingLeft:function(e){return 0===e?0:8},paddingRight:function(e,t){return e===t.table.widths.length-1?0:8}},lightHorizontalLines:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?0:e===t.table.headerRows?2:1},vLineWidth:function(e){return 0},hLineColor:function(e){return 1===e?"black":"#aaa"},paddingLeft:function(e){return 0===e?0:8},paddingRight:function(e,t){return e===t.table.widths.length-1?0:8}}})}function pageSize2widthAndHeight(e){if(isString(e)){var t=sizes[e.toUpperCase()];if(!t)throw"Page size "+e+" not recognized";return{width:t[0],height:t[1]}}return e}function updatePageOrientationInOptions(e,t){var i=t.options.size[0]>t.options.size[1]?"landscape":"portrait";if(e.pageSize.orientation!==i){var n=t.options.size[0],r=t.options.size[1];t.options.size=[r,n]}}function renderPages(e,t,i,n){i._pdfMakePages=e,i.addPage();var r=0;n&&e.forEach(function(e){r+=e.items.length});var o=0;n=n||function(){};for(var a=0;a<e.length;a++){a>0&&(updatePageOrientationInOptions(e[a],i),i.addPage(i.options));for(var s=e[a],l=0,d=s.items.length;l<d;l++){var h=s.items[l];switch(h.type){case"vector":renderVector(h.item,i);break;case"line":renderLine(h.item,h.item.x,h.item.y,i);break;case"image":renderImage(h.item,h.item.x,h.item.y,i);break;case"svg":renderSVG(h.item,h.item.x,h.item.y,i,t);break;case"beginClip":beginClip(h.item,i);break;case"endClip":endClip(i)}n(++o/r)}s.watermark&&renderWatermark(s,i)}}function renderLine(e,t,i,n){function r(e,t){var i,n,r=new TextTools(null);if(isUndefined(e.positions))throw"Page reference id not found";var o=e.positions[0].pageNumber.toString();switch(t.text=o,i=r.widthOfString(t.text,t.font,t.fontSize,t.characterSpacing,t.fontFeatures),n=t.width-i,t.width=i,t.alignment){case"right":t.x+=n;break;case"center":t.x+=n/2}}e._pageNodeRef&&r(e._pageNodeRef,e.inlines[0]),t=t||0,i=i||0;var o=e.getHeight(),a=o-e.getAscenderHeight();textDecorator.drawBackground(e,t,i,n);for(var s=0,l=e.inlines.length;s<l;s++){var d=e.inlines[s],h=o-d.font.ascender/1e3*d.fontSize-a;d._pageNodeRef&&r(d._pageNodeRef,d);var g={lineBreak:!1,textWidth:d.width,characterSpacing:d.characterSpacing,wordCount:1,link:d.link};d.linkToDestination&&(g.goTo=d.linkToDestination),e.id&&0===s&&(g.destination=e.id),d.fontFeatures&&(g.features=d.fontFeatures);var f=isNumber(d.opacity)?d.opacity:1;if(n.opacity(f),n.fill(d.color||"black"),n._font=d.font,n.fontSize(d.fontSize),n.text(d.text,t+d.x,i+h,g),d.linkToPage){n.ref({Type:"Action",S:"GoTo",D:[d.linkToPage,0,0]}).end();n.annotate(t+d.x,i+h,d.width,d.height,{Subtype:"Link",Dest:[d.linkToPage-1,"XYZ",null,null,null]})}}textDecorator.drawDecorations(e,t,i,n)}function renderWatermark(e,t){var i=e.watermark;t.fill(i.color),t.opacity(i.opacity),t.save(),t.rotate(i.angle,{origin:[t.page.width/2,t.page.height/2]});var n=t.page.width/2-i._size.size.width/2,r=t.page.height/2-i._size.size.height/2;t._font=i.font,t.fontSize(i.fontSize),t.text(i.text,n,r,{lineBreak:!1}),t.restore()}function renderVector(e,t){t.lineWidth(e.lineWidth||1),e.dash?t.dash(e.dash.length,{space:e.dash.space||e.dash.length,phase:e.dash.phase||0}):t.undash(),t.lineJoin(e.lineJoin||"miter"),t.lineCap(e.lineCap||"butt");var i=null;switch(e.type){case"ellipse":t.ellipse(e.x,e.y,e.r1,e.r2),e.linearGradient&&(i=t.linearGradient(e.x-e.r1,e.y,e.x+e.r1,e.y));break;case"rect":e.r?t.roundedRect(e.x,e.y,e.w,e.h,e.r):t.rect(e.x,e.y,e.w,e.h),e.linearGradient&&(i=t.linearGradient(e.x,e.y,e.x+e.w,e.y));break;case"line":t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2);break;case"polyline":if(0===e.points.length)break;t.moveTo(e.points[0].x,e.points[0].y);for(var n=1,r=e.points.length;n<r;n++)t.lineTo(e.points[n].x,e.points[n].y);if(e.points.length>1){var o=e.points[0],a=e.points[e.points.length-1];(e.closePath||o.x===a.x&&o.y===a.y)&&t.closePath()}break;case"path":t.path(e.d)}if(e.linearGradient&&i){var s=1/(e.linearGradient.length-1);for(n=0;n<e.linearGradient.length;n++)i.stop(n*s,e.linearGradient[n]);e.color=i}var l=isNumber(e.fillOpacity)?e.fillOpacity:1,d=isNumber(e.strokeOpacity)?e.strokeOpacity:1;e.color&&e.lineColor?(t.fillColor(e.color,l),t.strokeColor(e.lineColor,d),t.fillAndStroke()):e.color?(t.fillColor(e.color,l),t.fill()):(t.strokeColor(e.lineColor||"black",d),t.stroke())}function renderImage(e,t,i,n){var r=isNumber(e.opacity)?e.opacity:1;n.opacity(r),n.image(e.image,e.x,e.y,{width:e._width,height:e._height}),e.link&&n.link(e.x,e.y,e._width,e._height,e.link),e.linkToPage&&(n.ref({Type:"Action",S:"GoTo",D:[e.linkToPage,0,0]}).end(),n.annotate(e.x,e.y,e._width,e._height,{Subtype:"Link",Dest:[e.linkToPage-1,"XYZ",null,null,null]})),e.linkToDestination&&n.goTo(e.x,e.y,e._width,e._height,e.linkToDestination)}function renderSVG(e,t,i,n,r){var o=Object.assign({width:e._width,height:e._height,assumePt:!0},e.options);o.fontCallback=function(t,i,n){var o=t.split(",").map(function(e){return e.trim().replace(/('|")/g,"")}),a=findFont(r.fonts,o,e.font||"Roboto"),s=r.getFontFile(a,i,n);if(null===s){var l=r.getFontType(i,n);throw new Error("Font '"+a+"' in style '"+l+"' is not defined in the font section of the document definition.")}return s},getSvgToPDF()(n,e.svg,e.x,e.y,o)}function beginClip(e,t){t.save(),t.addContent(e.x+" "+e.y+" "+e.width+" "+e.height+" re"),t.clip()}function endClip(e){e.restore()}PdfPrinter.prototype.createPdfKitDocument=function(e,t){t=t||{},e.version=e.version||"1.3",e.compress=!isBoolean(e.compress)||e.compress,e.images=e.images||{},e.pageMargins=void 0!==e.pageMargins&&null!==e.pageMargins?e.pageMargins:40;var i=fixPageSize(e.pageSize,e.pageOrientation),n={size:[i.width,i.height],pdfVersion:e.version,compress:e.compress,userPassword:e.userPassword,ownerPassword:e.ownerPassword,permissions:e.permissions,fontLayoutCache:!isBoolean(t.fontLayoutCache)||t.fontLayoutCache,bufferPages:t.bufferPages||!1,autoFirstPage:!1,font:null};this.pdfKitDoc=PdfKitEngine.createPdfDocument(n),setMetadata(e,this.pdfKitDoc),this.fontProvider=new FontProvider(this.fontDescriptors,this.pdfKitDoc);var r=new LayoutBuilder(i,fixPageMargins(e.pageMargins),new ImageMeasure(this.pdfKitDoc,e.images),new SVGMeasure);registerDefaultTableLayouts(r),t.tableLayouts&&r.registerTableLayouts(t.tableLayouts);var o=r.layoutDocument(e.content,this.fontProvider,e.styles||{},e.defaultStyle||{fontSize:12,font:"Roboto"},e.background,e.header,e.footer,e.images,e.watermark,e.pageBreakBefore),a=e.maxPagesNumber||-1;if(isNumber(a)&&a>-1&&(o=o.slice(0,a)),i.height===1/0){var s=calculatePageHeight(o,e.pageMargins);this.pdfKitDoc.options.size=[i.width,s]}if(renderPages(o,this.fontProvider,this.pdfKitDoc,t.progressCallback),t.autoPrint){var l=this.pdfKitDoc.ref({Type:"Action",S:"Named",N:"Print"});this.pdfKitDoc._root.data.OpenAction=l,l.end()}return this.pdfKitDoc},module.exports=PdfPrinter;
//# sourceMappingURL=/sm/a9e1f56253a5845f5a3bedec93edec7c21f7f77761fd95539bcbc58967a79ee6.map